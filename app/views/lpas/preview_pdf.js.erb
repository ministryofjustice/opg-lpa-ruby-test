(function($){
  $('.preview_pdf_link').html('Generating PDF...');

  function getPDFLink() {
    var lpa_id = "<%=j @lpa_id %>";
    console.log('checking if pdf link is ready');
    $.ajax({
        url: "/lpas/"+lpa_id+"/get_pdf",
        data: {lpa_id: lpa_id},
        dataType: "json",
        async: false,
        timeout: 10000, // in miliseconds
        cache: false,
        success:function(data) {
            console.log('success');
            console.log(data.pdfURL);
            if(data.pdfURL) {
              window.location = data.pdfURL;
            } else {
              setTimeout(getPDFLink, 2000);
            }
        }
    });
  }

  getPDFLink();
})(jQuery);
