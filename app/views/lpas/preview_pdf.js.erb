/*jslint browser: true, evil: false, plusplus: true, white: true, indent: 2 */
/*global Poller, $ */

(function(){
  'use strict';

  // get id of LPAs
  var lpa_id = '<%=j @lpa_id %>',
      $link = $('#content').find('.js-preview-pdf');

  // create loading animation
  $link.addClass('disabled').blur().click(function() {
    return false;
  });

  // create new polling object
  var poller = new Poller({
    url: '/lpas/' + lpa_id + '/get_pdf',
    data: {lpa_id: lpa_id},
    onSuccess: function (response) {
      // redirect to PDF
      window.location = response.pdfURL;
    },
    onMaxAttempts: function (response) {

    },
    onMaxFails: function () {
      // make link clickable again
      $link.removeClass('disabled').unbind('click');
    }
  });
  // start polling
  poller.init();
})();
